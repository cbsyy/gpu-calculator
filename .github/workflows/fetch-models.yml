name: ÂÆöÊó∂ÊäìÂèñÂºÄÊ∫êÊ®°ÂûãÂàóË°®

on:
  schedule:
    # ÊØèÂ§©Âåó‰∫¨Êó∂Èó¥‰∏äÂçà9ÁÇπÊâßË°å (UTCÊó∂Èó¥ÂáåÊô®1ÁÇπ)
    - cron: '0 1 * * *'
  workflow_dispatch: # ÂÖÅËÆ∏ÊâãÂä®Ëß¶Âèë
  push:
    branches: [ main, master ]
    paths:
      - 'scripts/fetch-models.js'
      - '.github/workflows/fetch-models.yml'

jobs:
  fetch-models:
    runs-on: ubuntu-latest
    
    steps:
    - name: Ê£ÄÂá∫‰ª£Á†Å
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        
    - name: ËÆæÁΩÆNode.jsÁéØÂ¢É
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ÂÆâË£Ö‰æùËµñ
      run: |
        npm install axios cheerio
        
    - name: ÂàõÂª∫ÈÖçÁΩÆÁõÆÂΩï
      run: |
        mkdir -p src/config
        
    - name: ÊäìÂèñÊ®°ÂûãÊï∞ÊçÆ
      run: |
        node scripts/fetch-models.js
        
    - name: Ê£ÄÊü•Êñá‰ª∂ÂèòÂåñ
      id: check-changes
      run: |
        if git diff --quiet src/config/models.json; then
          echo "changed=false" >> $GITHUB_OUTPUT
          echo "Ê≤°ÊúâÊ£ÄÊµãÂà∞Ê®°ÂûãÈÖçÁΩÆÂèòÂåñ"
        else
          echo "changed=true" >> $GITHUB_OUTPUT
          echo "Ê£ÄÊµãÂà∞Ê®°ÂûãÈÖçÁΩÆÂèòÂåñ"
        fi
        
    - name: Êèê‰∫§Êõ¥Êñ∞
      if: steps.check-changes.outputs.changed == 'true'
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add src/config/models.json
        git commit -m "ü§ñ Ëá™Âä®Êõ¥Êñ∞ÂºÄÊ∫êÊ®°ÂûãÂàóË°® $(date +'%Y-%m-%d %H:%M:%S')"
        git push
        
    - name: ÁîüÊàêÊëòË¶ÅÊä•Âëä
      if: always()
      run: |
        echo "## üìä Ê®°ÂûãÊäìÂèñÊä•Âëä" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "- **ÊâßË°åÊó∂Èó¥**: $(date +'%Y-%m-%d %H:%M:%S UTC')" >> $GITHUB_STEP_SUMMARY
        echo "- **Êï∞ÊçÆÊ∫ê**: HuggingFace Open LLM Leaderboard" >> $GITHUB_STEP_SUMMARY
        
        if [ -f "src/config/models.json" ]; then
          MODEL_COUNT=$(node -e "const data = require('./src/config/models.json'); console.log(data.total_models || 0);")
          echo "- **Ê®°ÂûãÊÄªÊï∞**: $MODEL_COUNT" >> $GITHUB_STEP_SUMMARY
          
          if [ "${{ steps.check-changes.outputs.changed }}" == "true" ]; then
            echo "- **Áä∂ÊÄÅ**: ‚úÖ ÈÖçÁΩÆÂ∑≤Êõ¥Êñ∞" >> $GITHUB_STEP_SUMMARY
          else
            echo "- **Áä∂ÊÄÅ**: ‚ÑπÔ∏è Êó†ÂèòÂåñ" >> $GITHUB_STEP_SUMMARY
          fi
        else
          echo "- **Áä∂ÊÄÅ**: ‚ùå ÊäìÂèñÂ§±Ë¥•" >> $GITHUB_STEP_SUMMARY
        fi
        
    - name: ‰∏ä‰º†ÈÖçÁΩÆÊñá‰ª∂
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: models-config
        path: src/config/models.json
        retention-days: 30